<div class="root" fxLayout="column" fxLayoutAlign="space-between center">
    <div *ngIf="inputsForm != null" fxLayout="column" style="width: 100%">
        <p class="title">Please fill out plugin required inputs</p>
        <form [formGroup]="inputsForm" class="inputs">
            <div *ngFor="let input of inputs" [ngSwitch]="input.type">
                <ng-container *ngSwitchCase="'number'">
                    <ng-container
                        *ngTemplateOutlet="numberField; context: {input: input}">
                    </ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="'text'">
                    <ng-container
                        *ngTemplateOutlet="textField; context: {input: input}">
                    </ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="'selection'">
                    <ng-container
                        *ngTemplateOutlet="selectionField; context: {input: input}">
                    </ng-container>
                </ng-container>
            </div>
        </form>
    </div>
    <div *ngIf="inputsForm == null" fxLayout="row" fxLayoutAlign="center center" class="loading-inputs">
        <p>Loading plugin inputs...</p>
    </div>
    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="0.5em" class="actions">
        <button *ngIf="inputsForm != null" mat-raised-button color="primary"
                (click)="runPlugin()" [disabled]="!this.inputsForm.valid">
            Run
        </button>
        <button mat-raised-button color="accent"
                (click)="cancel()">
            Cancel
        </button>
    </div>
</div>

<ng-template #numberField let-input="input">
    <form [formGroup]="inputsForm">
        <mat-form-field *ngIf="input.options == null" class="input-field">
            <mat-label>{{input.label ?? input.name}}</mat-label>
            <input matInput [required]="input.required" [formControlName]="input.name" type="number"/>
            <mat-hint *ngIf="input.hint != null">{{input.hint}}</mat-hint>
        </mat-form-field>
        <mat-form-field *ngIf="input.options != null" class="input-field">
            <mat-label>{{input.label ?? input.name}}</mat-label>
            <input matInput [required]="input.required" [formControlName]="input.name" type="number"
                   [matAutocomplete]="auto"/>
            <mat-hint *ngIf="input.hint != null">{{input.hint}}</mat-hint>
            <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let option of input.options | filterInputOptions : inputsForm!.value[input.name]"
                            [value]="option.value">
                    <span>{{option.key}}</span>
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
    </form>
</ng-template>

<ng-template #textField let-input="input">
    <form [formGroup]="inputsForm">
        <mat-form-field *ngIf="input.options == null" class="input-field">
            <mat-label>{{input.label ?? input.name}}</mat-label>
            <input matInput [required]="input.required" [formControlName]="input.name" type="text"/>
            <mat-hint *ngIf="input.hint != null">{{input.hint}}</mat-hint>
        </mat-form-field>
        <mat-form-field *ngIf="input.options != null" class="input-field">
            <mat-label>{{input.label ?? input.name}}</mat-label>
            <input matInput [required]="input.required" [formControlName]="input.name" type="text"
                   [matAutocomplete]="auto"/>
            <mat-hint *ngIf="input.hint != null">{{input.hint}}</mat-hint>
            <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let option of input.options | filterInputOptions : inputsForm!.value[input.name]"
                            [value]="option.value">
                    <span>{{option.key}}</span>
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
    </form>
</ng-template>

<ng-template #selectionField let-input="input">
    <form [formGroup]="inputsForm">
        <mat-form-field class="input-field">
            <mat-label>{{input.label ?? input.name}}</mat-label>
            <mat-select [required]="input.required" [formControlName]="input.name">
                <mat-option *ngFor="let option of input.options" [value]="option.value">
                    {{option.key}}
                </mat-option>
            </mat-select>
            <mat-hint *ngIf="input.hint != null">{{input.hint}}</mat-hint>
        </mat-form-field>
    </form>
</ng-template>
